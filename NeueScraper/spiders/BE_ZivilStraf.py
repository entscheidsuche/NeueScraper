# -*- coding: utf-8 -*-
import scrapy
import re
import logging
from NeueScraper.spiders.tribuna import TribunaSpider

logger = logging.getLogger(__name__)
		
class BE_ZivilStraf(TribunaSpider):
	name = 'BE_ZivilStraf'
	custom_settings = {
		"CONCURRENT_REQUESTS_PER_DOMAIN": 1,
		"DOWNLOAD_DELAY": 2
	}
	
	RESULT_PAGE_URL = 'https://www.zsg-entscheide.apps.be.ch/tribunapublikation/tribunavtplus/loadTable'
	# Hole immer nur ein Dokument um Probleme mit Deduplizierung und unterschiedlichen Reihenfolgen zu verringern
	# RESULT_QUERY_TPL = r'''7|0|67|https://www.zsg-entscheide.apps.be.ch/tribunapublikation/tribunavtplus/|9012D0DA9E934A747A7FE70ABB27518D|tribunavtplus.client.zugriff.LoadTableService|search|java.lang.String/2004016611|java.util.ArrayList/4159755760|Z|I|java.util.Map||0|OG|BM|BJS|EO|O|0;false|5;true|E:\\webapps\\a2y\\a2ya-www-trbpub100web\\Thesaurus\\suisse.fts|1|java.util.HashMap/1797211028|reportpath|E:\\webapps\\a2y\\a2ya-www-trbpub100web\\Reports\\ExportResults.jasper|viewtype|2|reporttitle|reportexportpath|E:\\webapps\\a2y\\a2ya-www-trbpub100web\\Reports\\Export_1592254990808|reportname|Export_1592254990808|decisionDate|Entscheiddatum|dossierNumber|Dossier|classification|Zusatzeigenschaft|indexCode|Quelle|dossierObject|Betreff|law|Rechtsgebiet|shortText|Vorschautext|department|Gericht|createDate|Erfasst am|creater|Ersteller|judge|Richter|executiontype|Erledigungsart|legalDate|Rechtskraftdatum|objecttype|Objekttyp|typist|Schreiber|description|Beschreibung|reference|Referenz|relevance|Relevanz|de|1|2|3|4|41|5|5|6|7|6|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|8|8|5|5|5|5|7|9|9|5|5|5|5|5|5|5|10|11|6|0|0|6|5|5|12|5|13|5|14|5|15|5|16|10|10|10|10|10|10|10|10|10|10|10|10|10|10|10|10|10|10|10|10|1|{page_nr}|17|18|19|20|0|21|5|5|22|5|23|5|24|5|25|5|26|5|10|5|27|5|28|5|29|5|30|21|18|5|31|5|32|5|33|5|34|5|35|5|36|5|37|5|38|5|39|5|40|5|41|5|42|5|43|5|44|5|45|5|46|5|47|5|48|5|49|5|50|5|51|5|52|5|53|5|54|5|55|5|56|5|57|5|58|5|59|5|60|5|61|5|62|5|63|5|64|5|65|5|66|10|67|10|10|11|11|0|'''
	# RESULT_QUERY_TPL = r'''7|0|65|https://www.zsg-entscheide.apps.be.ch/tribunapublikation/tribunavtplus/|650CC7EFF80D4E2F1340EDCB95B99785|tribunavtplus.client.zugriff.LoadTableService|search|java.lang.String/2004016611|java.util.ArrayList/4159755760|Z|I|java.lang.Integer/3438268394|[B/3308590456|java.util.Map||0|OG|BM|BJS|EO|O|WSG|0;false|5;true|1|java.util.HashMap/1797211028|reportpath|viewtype|reporttitle|reportexportpath|reportname|decisionDate|Entscheiddatum|dossierNumber|Dossier|classification|Zusatzeigenschaft|indexCode|Quelle|dossierObject|Betreff|law|Rechtsgebiet|shortText|Vorschautext|department|Gericht|createDate|Erfasst am|creater|Ersteller|judge|Richter|executiontype|Erledigungsart|legalDate|Rechtskraftdatum|objecttype|Objekttyp|typist|Schreiber|description|Beschreibung|reference|Referenz|relevance|Relevanz|de|1|2|3|4|47|5|5|6|7|6|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|8|8|8|5|5|9|9|9|5|5|10|5|7|11|11|5|5|5|5|5|5|5|12|13|6|0|0|6|6|5|14|5|15|5|16|5|17|5|18|5|19|12|12|12|12|12|12|12|12|12|12|12|12|12|12|12|12|12|12|12|12|1|{page_nr}|-1|12|12|9|4557|9|0|9|-1|20|21|10|62|69|58|92|92|119|101|98|97|112|112|115|92|92|97|50|121|92|92|97|50|121|97|45|119|119|119|45|116|114|98|112|117|98|49|48|48|119|101|98|92|92|84|104|101|115|97|117|114|117|115|92|92|115|117|105|115|115|101|46|102|116|115|22|0|23|5|5|24|10|69|69|58|92|92|119|101|98|97|112|112|115|92|92|97|50|121|92|92|97|50|121|97|45|119|119|119|45|116|114|98|112|117|98|49|48|48|119|101|98|92|92|82|101|112|111|114|116|115|92|69|120|112|111|114|116|82|101|115|117|108|116|115|46|106|97|115|112|101|114|5|25|10|1|50|5|26|10|0|5|27|10|69|69|58|92|92|119|101|98|97|112|112|115|92|92|97|50|121|92|92|97|50|121|97|45|119|119|119|45|116|114|98|112|117|98|49|48|48|119|101|98|92|92|82|101|112|111|114|116|115|92|69|120|112|111|114|116|95|49|54|57|53|56|48|50|54|55|55|56|50|55|5|28|10|22|34|69|120|112|111|114|116|95|34|49|54|57|53|56|48|50|54|55|55|56|50|55|23|18|5|29|5|30|5|31|5|32|5|33|5|34|5|35|5|36|5|37|5|38|5|39|5|40|5|41|5|42|5|43|5|44|5|45|5|46|5|47|5|48|5|49|5|50|5|51|5|52|5|53|5|54|5|55|5|56|5|57|5|58|5|59|5|60|5|61|5|62|5|63|5|64|12|65|12|12|13|13|0|'''
	RESULT_QUERY_TPL = r'''7|0|60|https://www.zsg-entscheide.apps.be.ch/tribunapublikation/tribunavtplus/|CAC80118FB77794F1FDFC1B51371CC63|tribunavtplus.client.zugriff.LoadTableService|search|java.lang.String/2004016611|java.util.ArrayList/4159755760|Z|I|java.lang.Integer/3438268394|java.util.Map||0|OG|BM|BJS|EO|O|WSG|0;false|5;true|323719a1159f182ebd8af5cfa97b333ff61114ecd421be6d2c393d33132eb663eb86b97d6427404378ba30f32ed94bc03acd984a38069ff31de37ff0df24c54f|1|java.util.HashMap/1797211028|decisionDate|Entscheiddatum|dossierNumber|Dossier|classification|Zusatzeigenschaft|indexCode|Quelle|dossierObject|Betreff|law|Rechtsgebiet|shortText|Vorschautext|department|Gericht|createDate|Erfasst am|creater|Ersteller|judge|Richter|executiontype|Erledigungsart|legalDate|Rechtskraftdatum|objecttype|Objekttyp|typist|Schreiber|description|Beschreibung|reference|Referenz|relevance|Relevanz|de|1|2|3|4|46|5|5|6|7|6|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|8|8|8|5|5|9|9|9|5|5|5|5|7|10|5|5|5|5|5|5|5|11|12|6|0|0|6|6|5|13|5|14|5|15|5|16|5|17|5|18|11|11|11|11|11|11|11|11|11|11|11|11|11|11|11|11|11|11|11|11|1|{page_nr}|-1|11|11|0|9|0|9|-1|19|20|21|22|0|23|18|5|24|5|25|5|26|5|27|5|28|5|29|5|30|5|31|5|32|5|33|5|34|5|35|5|36|5|37|5|38|5|39|5|40|5|41|5|42|5|43|5|44|5|45|5|46|5|47|5|48|5|49|5|50|5|51|5|52|5|53|5|54|5|55|5|56|5|57|5|58|5|59|11|60|11|11|12|12|0|'''
	# RESULT_QUERY_TPL_AB = r'''7|0|68|https://www.zsg-entscheide.apps.be.ch/tribunapublikation/tribunavtplus/|9012D0DA9E934A747A7FE70ABB27518D|tribunavtplus.client.zugriff.LoadTableService|search|java.lang.String/2004016611|java.util.ArrayList/4159755760|Z|I|java.util.Map||0|OG|BM|BJS|EO|O|{datum}|0;false|5;true|E:\\webapps\\a2y\\a2ya-www-trbpub100web\\Thesaurus\\suisse.fts|1|java.util.HashMap/1797211028|reportpath|E:\\webapps\\a2y\\a2ya-www-trbpub100web\\Reports\\ExportResults.jasper|viewtype|2|reporttitle|reportexportpath|E:\\webapps\\a2y\\a2ya-www-trbpub100web\\Reports\\Export_1595357657961|reportname|Export_1595357657961|decisionDate|Entscheiddatum|dossierNumber|Dossier|classification|Zusatzeigenschaft|indexCode|Quelle|dossierObject|Betreff|law|Rechtsgebiet|shortText|Vorschautext|department|Gericht|createDate|Erfasst am|creater|Ersteller|judge|Richter|executiontype|Erledigungsart|legalDate|Rechtskraftdatum|objecttype|Objekttyp|typist|Schreiber|description|Beschreibung|reference|Referenz|relevance|Relevanz|de|1|2|3|4|41|5|5|6|7|6|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|8|8|5|5|5|5|7|9|9|5|5|5|5|5|5|5|10|11|6|0|0|6|5|5|12|5|13|5|14|5|15|5|16|10|10|10|10|10|10|10|10|10|10|10|10|10|10|10|10|10|10|10|17|1|{page_nr}|18|19|20|21|0|22|5|5|23|5|24|5|25|5|26|5|27|5|10|5|28|5|29|5|30|5|31|22|18|5|32|5|33|5|34|5|35|5|36|5|37|5|38|5|39|5|40|5|41|5|42|5|43|5|44|5|45|5|46|5|47|5|48|5|49|5|50|5|51|5|52|5|53|5|54|5|55|5|56|5|57|5|58|5|59|5|60|5|61|5|62|5|63|5|64|5|65|5|66|5|67|10|68|10|10|11|11|0|'''
	RESULT_QUERY_TPL_AB = r'''7|0|66|https://www.zsg-entscheide.apps.be.ch/tribunapublikation/tribunavtplus/|650CC7EFF80D4E2F1340EDCB95B99785|tribunavtplus.client.zugriff.LoadTableService|search|java.lang.String/2004016611|java.util.ArrayList/4159755760|Z|I|java.lang.Integer/3438268394|[B/3308590456|java.util.Map||0|OG|BM|BJS|EO|O|WSG|{datum}|0;false|5;true|1|java.util.HashMap/1797211028|reportpath|viewtype|reporttitle|reportexportpath|reportname|decisionDate|Entscheiddatum|dossierNumber|Dossier|classification|Zusatzeigenschaft|indexCode|Quelle|dossierObject|Betreff|law|Rechtsgebiet|shortText|Vorschautext|department|Gericht|createDate|Erfasst am|creater|Ersteller|judge|Richter|executiontype|Erledigungsart|legalDate|Rechtskraftdatum|objecttype|Objekttyp|typist|Schreiber|description|Beschreibung|reference|Referenz|relevance|Relevanz|de|1|2|3|4|47|5|5|6|7|6|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|5|8|8|8|5|5|9|9|9|5|5|10|5|7|11|11|5|5|5|5|5|5|5|12|13|6|0|0|6|6|5|14|5|15|5|16|5|17|5|18|5|19|12|12|12|20|12|12|12|12|12|12|12|12|12|12|12|12|12|12|12|12|1|{page_nr}|-1|12|12|9|4557|9|0|9|-1|21|22|10|62|69|58|92|92|119|101|98|97|112|112|115|92|92|97|50|121|92|92|97|50|121|97|45|119|119|119|45|116|114|98|112|117|98|49|48|48|119|101|98|92|92|84|104|101|115|97|117|114|117|115|92|92|115|117|105|115|115|101|46|102|116|115|23|0|24|5|5|25|10|69|69|58|92|92|119|101|98|97|112|112|115|92|92|97|50|121|92|92|97|50|121|97|45|119|119|119|45|116|114|98|112|117|98|49|48|48|119|101|98|92|92|82|101|112|111|114|116|115|92|69|120|112|111|114|116|82|101|115|117|108|116|115|46|106|97|115|112|101|114|5|26|10|1|50|5|27|10|0|5|28|10|69|69|58|92|92|119|101|98|97|112|112|115|92|92|97|50|121|92|92|97|50|121|97|45|119|119|119|45|116|114|98|112|117|98|49|48|48|119|101|98|92|92|82|101|112|111|114|116|115|92|69|120|112|111|114|116|95|49|54|57|53|56|48|50|56|50|54|55|51|53|5|29|10|22|34|69|120|112|111|114|116|95|34|49|54|57|53|56|48|50|56|50|54|55|51|53|24|18|5|30|5|31|5|32|5|33|5|34|5|35|5|36|5|37|5|38|5|39|5|40|5|41|5|42|5|43|5|44|5|45|5|46|5|47|5|48|5|49|5|50|5|51|5|52|5|53|5|54|5|55|5|56|5|57|5|58|5|59|5|60|5|61|5|62|5|63|5|64|5|65|12|66|12|12|13|13|0|'''
	HEADERS = { 'Content-type': 'text/x-gwt-rpc; charset=utf-8'
			  , 'X-GWT-Permutation': 'C56BCDCE0FCCE64CB5164DE7BBAF017B'
			  , 'X-GWT-Module-Base': 'https://www.zsg-entscheide.apps.be.ch/tribunapublikation/tribunavtplus/'
			  }
	MINIMUM_PAGE_LEN = 148
	DOWNLOAD_URL = 'https://www.zsg-entscheide.apps.be.ch/tribunapublikation/tribunavtplus/ServletDownload/'
	# PDF_PATH = 'E%3A%5C%5Cwebapps%5C%5Ca2y%5C%5Ca2ya-www-trbpub100web%5C%5Cpdf%5C'
	PDF_PATH = ''
	# PDF_PATTERN = "{}{}_{}.pdf?path={}{}.pdf&dossiernummer={}"
	# PDF_PATTERN = "{}{}_{}.pdf?path={}&pathIsEncrypted=1&dossiernummer={}"
	PDF_PATTERN = "{}{}?path={}&pathIsEncrypted=1&dossiernummer={}"
	ENCRYPTED = True
	ASCII_ENCRYPTED = True
	DECRYPT_PAGE_URL = "https://www.zsg-entscheide.apps.be.ch/tribunapublikation/tribunavtplus/loadTable"
	DECRYPT_START ='7|0|11|https://www.zsg-entscheide.apps.be.ch/tribunapublikation/tribunavtplus/|CAC80118FB77794F1FDFC1B51371CC63|tribunavtplus.client.zugriff.LoadTableService|urlEncodingTribuna|java.util.Map|java.util.HashMap/1797211028|java.lang.String/2004016611|partURL|'
	DECRYPT_END = '|1|2|3|4|1|5|6|2|7|8|7|9|7|10|7|11|'


	reNum=re.compile('\D{2,3}\s\d\d\d\d\s\d+')
	
